@page "/edit/{DeviceGuid}"
@inject DeviceService DeviceService
@inject Microsoft.AspNetCore.Blazor.Services.IUriHelper UriHelper

@if (initialized == true)
{
    @if (Item != null)
    {
        <DeviceForm Item="@Item" OnClickOK="@OnClickOK"></DeviceForm>
    }
    else
    {
        <p class="error-message">デバイス情報が見つかりません。</p>
    }
}

@functions {
    [Parameter]
    string DeviceGuid { get; set; }

    bool initialized = false;

    Device Item;

    protected override async Task OnInitAsync()
    {
        var device = await DeviceService.GetDeviceAsync(Guid.Parse(DeviceGuid));
        if (device != null)
        {
            Item = new Device
            {
                Name = device.Name,
                MACAddress = device.MACAddress
            };
        }
        initialized = true;
    }

    async Task OnClickOK(Device editedDevice)
    {
        await DeviceService.UpdateDeviceAsync(Guid.Parse(DeviceGuid), editedDevice);
        UriHelper.NavigateTo("/");
    }
}